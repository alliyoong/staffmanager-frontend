<div class="container mt-4">
  <h3>Staff List</h3>
  <form #searchForm="ngForm" (ngSubmit)="applyFilter(searchForm.value)">
    <div class="row g-3 p-3">
      <div class="col-md-2">
        <div class="form-group">
          <label for="nameSearchTerm">Name</label>
          <input ngModel name="nameSearchTerm" type="text" class="form-control" id="nameSearchTerm"
            placeholder="Search by name">
        </div>
      </div>
      <div class="col-md-2">
        <div class="form-group">
          <label for="emailSearchTerm">Email</label>
          <input ngModel type="text" class="form-control" name="emailSearchTerm" id="emailSearchTerm"
            placeholder="Search by email">
        </div>
      </div>
      <div class="col-md-2">
        <div class="form-group">
          <label for="ssnSearchTerm">SSN</label>
          <input ngModel type="text" class="form-control" name="ssnSearchTerm" id="ssnSearchTerm"
            placeholder="Search by SSN">
        </div>
      </div>
      <div class="col-md-2">
        <div class="form-group">
          <label for="departmentSearchTerm">Department</label>
          <select ngModel class="form-select" name="departmentSearchTerm" id="departmentSearchTerm"
            aria-label="department select" aria-placeholder="Search by department">
            @for(data of departmentOption$ | async; track data){
            <option value="{{data.departmentId}}">{{data.departmentName}}</option>
            }
          </select>
        </div>
      </div>
      <div class="col-md-2">
        <div class="form-group">
          <label for="statusSearchTerm">Status</label>
          <select ngModel class="form-select" name="statusSearchTerm" id="statusSearchTerm" aria-label="status select"
            aria-placeholder="Search by status">
            @for(data of statusOption$ | async; track data){
            <option value="{{data}}">{{data}}</option>
            }
          </select>
        </div>
      </div>
      <div class="col-md-2">
        <div class="mt-2">
          <button class="btn btn-lg btn-outline-success" type="submit">Filter</button>
        </div>
        <div class="mt-2">
          <button class="btn btn-lg btn-outline-info" type="button" (click)="clearFilter(searchForm)">Clear</button>
        </div>
      </div>
    </div>
  </form>
  @if(this.username){
  <h5 class="text-success text-center">Welcome {{this.username}}</h5>
  }
  @if(staffList$ | async; as page){
  <!-- {{staffList$ | async | json}} -->
  <table class="table table-striped table-bordered">
    <thead class="thead-light">
      <tr>
        <th scope="col" class="text-warning">ID</th>
        <th scope="col" class="text-warning">Name</th>
        <th scope="col" class="text-warning">Email</th>
        <th scope="col" class="text-warning">SSN</th>
        <th scope="col" class="text-warning">Phone Number</th>
        <th scope="col" class="text-warning">Gender</th>
        <th scope="col" class="text-warning">Date Of Birth</th>
        <th scope="col" class="text-warning">Join Date</th>
        <th scope="col" class="text-warning">Department</th>
        <th scope="col" class="text-warning">Job Position</th>
        <th scope="col" class="text-warning">Status</th>
        <th scope="col" class="text-warning">Action</th>
      </tr>
    </thead>
    <tbody>
      @for(data of page.content; track data){
      <tr>
        <th scope="row">{{data.staffId}}</th>
        <td>{{data.name}}</td>
        <td>{{data.email}}</td>
        <td>{{data.socialSecurityNumber}}</td>
        <td>{{data.phoneNumber}}</td>
        <td>{{data.gender}}</td>
        <td>{{data.dateOfBirth}}</td>
        <td>{{data.joinDate}}</td>
        <td>{{data.departmentDto.departmentName}}</td>
        <td>{{data.jobPosition.jobPositionName}}</td>
        <td>{{data.staffStatus}}</td>
        <td>
          <button class="btn btn-info btn-sm" data-toggle="tooltip" title="Edit" (click)="openEdit(data)">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn btn-danger btn-sm" data-toggle="tooltip" title="Delete" (click)="openDelete(data)">
            <i class="fas fa-trash"></i>
          </button>
          <button class="btn btn-success btn-sm" data-toggle="tooltip" title="Manage Account"
            (click)="openAccount(data)">
            <i class="fas fa-user"></i>
          </button>
          <button class="btn btn-warning btn-sm" data-toggle="tooltip" title="Show attendance"
            (click)="openAttendance(data)">
            <i class="fas fa-list"></i>
          </button>
        </td>
      </tr>
      }
      @empty {
      <tr>
        <td colspan="3" class="text-center">No staffs found</td>
      </tr>
      }
    </tbody>
  </table>

  <!-- Pagination -->
  <nav>
    <ul class="pagination">
      <li class="page-item" [class.disabled]="page.number === 0">
        <a class="page-link" (click)="prevPage()">Previous</a>
      </li>

      <li class="page-item disabled">
        <a class="page-link">Page {{ page.number + 1 }} of {{ page.totalPages }}</a>
      </li>

      <li class="page-item" [class.disabled]="page.number >= page.totalPages - 1">
        <a class="page-link" (click)="nextPage(page.totalPages)">Next</a>
      </li>
    </ul>
  </nav>
  }
</div>

<app-delete-staff></app-delete-staff>
<app-edit-staff [receivedStaff]=selectedStaff></app-edit-staff>
<app-add-account [receivedStaff]=selectedStaff></app-add-account>
<app-edit-account [receivedAccount]=selectedAccount()></app-edit-account>
<!-- <app-attendance-list></app-attendance-list> -->
<!-- <app-attendance-list [receivedStaff]=selectedStaff></app-attendance-list> -->